<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheeky Commodore Gamer | Full Game Index</title>

    <!-- Font: same vibe as your other pages -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

    <!-- Font Awesome for icons -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- PapaParse for CSV parsing -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <style>
        body {
            margin: 0;
            background: #000;
            color: #eee;
            font-family: 'VT323', monospace;
        }

        
        /* SOCIAL STRIP */
        .social-strip {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0 30px 0;
            padding: 10px 0;
            border-top: 1px dashed rgba(108, 94, 181, 0.5);
            border-bottom: 1px dashed rgba(108, 94, 181, 0.5);
        }
        .social-link-item {
            color: var(--c64-light-blue);
            font-size: 1.2rem;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .social-link-item:hover {
            color: #fff;
            background: rgba(108, 94, 181, 0.2);
            border-color: var(--c64-light-blue);
            text-decoration: none;
            transform: translateY(-2px);
            text-shadow: 0 0 5px var(--c64-light-blue);
        }
        .social-link-item i { font-size: 1.3rem; }

</style>
</head>
<body>

    <!-- SOCIAL STRIP - put this on every page -->
    <div class="social-strip">
        <a href="https://www.youtube.com/@CheekyCommodoreGamer" target="_blank" class="social-link-item play-sound">
            <i class="fa-brands fa-youtube"></i> YOUTUBE
        </a>
        <a href="https://patreon.com/CheekyCommodoreGamer" target="_blank" class="social-link-item play-sound">
            <i class="fa-brands fa-patreon"></i> PATREON
        </a>
        <a href="https://facebook.com/cheekycommodoregamer" target="_blank" class="social-link-item play-sound">
            <i class="fa-brands fa-facebook"></i> FACEBOOK
        </a>
        <a href="https://twitter.com/CheekyC64Gamer" target="_blank" class="social-link-item play-sound">
            <i class="fa-brands fa-x-twitter"></i> TWITTER
        </a>
        <a href="https://discord.gg/83Xw9ktAn4" target="_blank" class="social-link-item play-sound">
            <i class="fa-brands fa-discord"></i> DISCORD
        </a>
        <a href="https://www.paypal.com/donate/?hosted_button_id=LGG86ZV9P4YKL" target="_blank" class="social-link-item play-sound">
            <i class="fa-brands fa-paypal"></i> DONATE
        </a>
    </div>

    <div class="page-wrapper">
        <h1>Full Game Index</h1>
        <div class="subtitle">
            Live from the master spreadsheet â€“ add a game in the sheet, and it appears here automatically.
        </div>

        <div class="controls-bar">
            <div id="game-count">Games: loadingâ€¦</div>
            <input id="game-search" type="text" placeholder="Search by title, genreâ€¦ (try 'Batman')" />
        </div>

        <div id="game-list">
            <!-- Games will be injected here -->
        </div>
    </div>

    <script>
        // ðŸ”— 1. Your published CSV URL
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQWiuznK7CJeHvaMSAmdVyzDEdpeNQxXGjhqEzsvzLTV792D_B1B5pA55T6kV7maskDFkn0oU0CQ3JM/pub?gid=1584452405&single=true&output=csv";

        // Internal store of all games
        let ALL_GAMES = [];

        // 2. Fetch & parse the CSV using PapaParse
        Papa.parse(CSV_URL, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function (results) {
                const rows = results.data || [];

                // Build cleaned game list
                ALL_GAMES = rows
                    .filter(row => row.gametitle && row.gametitle.trim() !== "")
                    .map((row, index) => {
                        const title = (row.gametitle || "").trim();
                        const sortTitle = (row.sorttitle || title).trim();
                        const genres = (row.genre || "")
                            .split(",")
                            .map(g => g.trim())
                            .filter(Boolean);

                        return {
                            id: (row.gameid || `row-${index}`).trim(),
                            title,
                            sortTitle,
                            genres,
                            videoId: (row.videoid || "").trim(),
                            lemonLink: (row.lemonlinks || "").trim(),
                            thumb: (row.thumblink || "").trim(),
                            pdf: (row.pdflink || "").trim(),
                            disk: (row.disklinks || "").trim()
                        };
                    });

                // Sort by sortTitle
                ALL_GAMES.sort((a, b) =>
                    a.sortTitle.toLowerCase().localeCompare(b.sortTitle.toLowerCase())
                );

                // Initial render
                updateGameCount(ALL_GAMES.length);
                renderGameList(ALL_GAMES);
            },
            error: function (err) {
                console.error("Error loading CSV:", err);
                document.getElementById("game-count").textContent = "Games: error loading data";
            }
        });

        // 3. Render functions
        function updateGameCount(count) {
            const el = document.getElementById("game-count");
            if (!el) return;
            el.textContent = "Games: " + count;
        }

        function renderGameList(list) {
            const container = document.getElementById("game-list");
            if (!container) return;

            if (!list || list.length === 0) {
                container.innerHTML = "<div>No matching games found.</div>";
                return;
            }

            const html = list.map(game => {
                const genreText = game.genres.join(" Â· ");
                const thumbHtml = game.thumb
                    ? `<img class="game-thumb" src="${game.thumb}" alt="${escapeHtml(game.title)} cover">`
                    : `<div class="game-thumb"></div>`;

                let linksHtml = "";

                if (game.videoId) {
                    linksHtml += `<a class="game-link-btn" href="https://www.youtube.com/watch?v=${game.videoId}" target="_blank">Video</a>`;
                }
                if (game.lemonLink) {
                    linksHtml += `<a class="game-link-btn" href="${game.lemonLink}" target="_blank">Lemon</a>`;
                }
                if (game.pdf) {
                    linksHtml += `<a class="game-link-btn" href="${game.pdf}" target="_blank">PDF</a>`;
                }
                if (game.disk) {
                    linksHtml += `<a class="game-link-btn" href="${game.disk}" target="_blank">Disk</a>`;
                }

                return `
                    <div class="game-item">
                        ${thumbHtml}
                        <div class="game-main">
                            <div class="game-title">${escapeHtml(game.title)}</div>
                            ${genreText ? `<div class="game-genres">${escapeHtml(genreText)}</div>` : ""}
                            <div class="game-links">${linksHtml}</div>
                        </div>
                    </div>
                `;
            }).join("");

            container.innerHTML = html;
        }

        // 4. Simple search
        const searchInput = document.getElementById("game-search");
        if (searchInput) {
            searchInput.addEventListener("input", function () {
                const term = this.value.toLowerCase();

                if (!term) {
                    updateGameCount(ALL_GAMES.length);
                    renderGameList(ALL_GAMES);
                    return;
                }

                const filtered = ALL_GAMES.filter(game => {
                    const haystack = [
                        game.title,
                        game.sortTitle,
                        (game.genres || []).join(" ")
                    ].join(" ").toLowerCase();

                    return haystack.includes(term);
                });

                updateGameCount(filtered.length);
                renderGameList(filtered);
            });
        }

        // 5. Helper: basic HTML escaping
        function escapeHtml(str) {
            return (str || "")
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
